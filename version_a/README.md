Non-OO version. Written as a script, instead 